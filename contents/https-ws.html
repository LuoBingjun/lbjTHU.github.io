<!doctype html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

<head>
    <meta charset="UTF-8">
    <title>使用https和ws模块搭建wss服务器 | 骆炳君的个人主页</title>
</head>


<link rel="stylesheet" type="text/css" href="../style.css">
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
        extensions: ["tex2jax.js", "TeX/noErrors.js", "TeX/AMSsymbols.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
            inlineMath: [['$', '$'], ["\\(", "\\)"]],
            displayMath: [['\\[', '\\]'], ['$$', '$$']],
            balanceBraces: true

        },
        TeX: { equationNumbers: { autoNumber: ["AMS"], useLabelIds: true } },
        "HTML-CSS": { availableFonts: ["TeX"] },
    });
</script>

<body>
    <header>
        <h1>骆炳君的个人主页</h1>
        <nav>
            <a href="../index.html">
                <h3>首页</h3>
            </a>
            <a href="../about.html">
                <h3>关于我</h3>
            </a>
        </nav>
    </header>

    <main>
        <aside id="contents">
            <div id="div_logo">
                <img src="http://www.lbjthu.tech/blog/images/logo.jpg" id="logo">
            </div>
            <div id="div_intro">
                <h2>
                    骆炳君
                </h2>
                <h3>
                    五道口体校本科生<br>
                </h3>
                <p>
                    E-mail:
                    <a href="mailto:luobingjun@gmail.com"> @luobingjun
                    </a><br>
                    GitHub:
                    <a href="https://github.com/LuoBingjun"> @LuoBingjun
                    </a><br>
                    知乎:
                    <a href="https://www.zhihu.com/people/luo-bing-jun-63/"> @骆炳君
                    </a><br>
                    Steam: @Kayano32
                </p>
            </div>
        </aside>
        <div id="category">
            <article>
                <h1>使用https和ws模块搭建wss服务器</h1>
<h2>介绍</h2>
<p>HTTPS是安全HTTP协议，WebSocket协议是建立在TCP协议上的一种网络通信协议，具有数据轻便、双向通信等特点，适合对实时性和可靠性要求比较高的连接。将HTTPS和WebSocket结合起来就可以实现一种安全的WebSocket协议，即wss协议。</p>
<p>在Node.js中，利用https和ws模块就可以简单搭建wss服务器。</p>
<h2>搭建环境</h2>
<p>安装https模块：</p>
<pre><code class='language-shell' lang='shell'>$ npm install https --save
</code></pre>
<p>安装ws模块：</p>
<pre><code class='language-shell' lang='shell'>$ npm install ws --save
</code></pre>
<h2>配置服务器</h2>
<p>首先使用https模块搭建HTTPS服务器监听，其中options中包括了SSL协议所需要的证书信息，app是处理一般HTTPS请求的函数：</p>
<pre><code class='language-javascript' lang='javascript'>var options = {
  key: fs.readFileSync(keypath),
  cert: fs.readFileSync(certpath)
}
var httpsServer = https.createServer(options, app).listen(port)
</code></pre>
<p>然后将这个服务器绑定到ws模块的WebSocket服务器上：</p>
<pre><code class='language-javascript' lang='javascript'>var wssServer = new ws.Server({ server: this.httpsServer })
</code></pre>
<p>这样就搭建好了wss服务器。</p>
<h2>部署监听</h2>
<p>wss服务器在监听到建立连接的请求时，会触发connection事件，并传入该连接所对应的WebSocket，可以通过绑定该事件来监听</p>
<pre><code class='language-javascript' lang='javascript'>wssServer.on(&#39;connection&#39;, wssHandler)
</code></pre>
<p>至此，我们就完成了wss服务器搭建的基本过程，通过填充wssHandler函数就可以和普通WebSocket一样操作新建的WebSocket连接了。</p></article>
        </div>
    </main>

    <footer>
        Copyright @骆炳君
    </footer>
</body>

</html>